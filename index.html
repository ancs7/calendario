<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calendario de Cupones</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .dia {
      margin: 5px;
      padding: 10px;
      background-color: #eee;
      border-radius: 5px;
      display: inline-block;
      cursor: pointer;
      position: relative;
      min-width: 80px;
      text-align: center;
    }
    .dia.canjeado {
      background-color: #90ee90;
      cursor: default;
      text-decoration: line-through;
    }
    .btn-descanjear {
      display: none;
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff4d4d;
      border: none;
      color: white;
      padding: 3px 6px;
      border-radius: 3px;
      font-size: 10px;
      cursor: pointer;
    }
    .dia.canjeado .btn-descanjear {
      display: block;
    }
  </style>
</head>
<body>

  <h1>Calendario de Cupones</h1>

  <div id="calendario">
    <div class="dia" data-dia="1">D√≠a 1
      <button class="btn-descanjear">Descanjear</button>
    </div>
    <div class="dia" data-dia="2">D√≠a 2
      <button class="btn-descanjear">Descanjear</button>
    </div>
    <div class="dia" data-dia="3">D√≠a 3
      <button class="btn-descanjear">Descanjear</button>
    </div>
    <div class="dia" data-dia="4">D√≠a 4
      <button class="btn-descanjear">Descanjear</button>
    </div>
    <div class="dia" data-dia="5">D√≠a 5
      <button class="btn-descanjear">Descanjear</button>
    </div>
    <!-- Pod√©s agregar m√°s d√≠as igual -->
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDmO0eVx-1RLQjGsvBxNiS92Rqc2wZ5VEk",
      authDomain: "cupones-41b71.firebaseapp.com",
      projectId: "cupones-41b71",
      storageBucket: "cupones-41b71.firebasestorage.app",
      messagingSenderId: "866981366254",
      appId: "1:866981366254:web:16dba30b2e82ca2809e6ff",
      measurementId: "G-E5VY5HG9W7"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const analytics = firebase.analytics(app);
    const database = firebase.database();

    const userId = 'novia'; // identificador para la base de datos

    // Cargar estado desde Firebase
    function cargarCupones() {
      firebase.database().ref('cupones/' + userId).once('value', snapshot => {
        const cupones = snapshot.val() || {};
        for (const dia in cupones) {
          if (cupones[dia]) {
            marcarDiaCanjeado(dia);
          }
        }
      });
    }

    function marcarDiaCanjeado(dia) {
      const elemento = document.querySelector(`.dia[data-dia="${dia}"]`);
      if (elemento) {
        elemento.classList.add('canjeado');
        elemento.childNodes[0].nodeValue = `D√≠a ${dia} ‚úÖ`; // Cambiar texto visible
        elemento.style.pointerEvents = 'none'; // evita clicks en el div
        // Pero el bot√≥n "descanjear" debe poder funcionar
        const btn = elemento.querySelector('.btn-descanjear');
        if (btn) {
          btn.style.display = 'block';
          elemento.style.pointerEvents = 'auto'; // habilitar para el bot√≥n
        }
      }
    }

    function canjearDia(dia) {
      firebase.database().ref('cupones/' + userId + '/' + dia).set(true);
    }

    function descanjearDia(dia) {
      firebase.database().ref('cupones/' + userId + '/' + dia).remove();
      const elemento = document.querySelector(`.dia[data-dia="${dia}"]`);
      if (elemento) {
        elemento.classList.remove('canjeado');
        elemento.childNodes[0].nodeValue = `D√≠a ${dia}`;
        const btn = elemento.querySelector('.btn-descanjear');
        if (btn) {
          btn.style.display = 'none';
        }
        elemento.style.pointerEvents = 'auto';
      }
    }

    // Evento para canjear d√≠as (click en div)
    document.querySelectorAll('.dia').forEach(elem => {
      elem.addEventListener('click', e => {
        // Evitar que el click en el bot√≥n "descanjear" active esto
        if (e.target.classList.contains('btn-descanjear')) return;

        const dia = elem.getAttribute('data-dia');
        if (!elem.classList.contains('canjeado')) {
          marcarDiaCanjeado(dia);
          canjearDia(dia);
          alert(`¬°Cup√≥n D√≠a ${dia} canjeado! üéâ`);
        }
      });
    });

    // Evento para descanjear d√≠as (click en bot√≥n)
    document.querySelectorAll('.btn-descanjear').forEach(btn => {
      btn.addEventListener('click', e => {
        e.stopPropagation(); // evitar que el click burbujee al div padre
        const dia = btn.parentElement.getAttribute('data-dia');
        descanjearDia(dia);
        alert(`Cup√≥n D√≠a ${dia} liberado.`);
      });
    });

    // Cargar estado al iniciar
    cargarCupones();
  </script>

</body>
</html>
